计算机通常只有一个 CPU,在任意时刻只能执行一条机器指令,每个线程只有获得
CPU 的使用权才能执行指令.所谓多线程的并发运行,其实是指从宏观上看,各个线
程轮流获得 CPU 的使用权,分别执行各自的任务.在运行池中,会有多个处于就绪状
态的线程在等待 CPU,JAVA 虚拟机的一项任务就是负责线程的调度,线程调度是指
按照特定机制为多个线程分配 CPU 的使用权.

#CPU调度线程的方式？(重要)
[有两种调度模型：分时调度模型和抢占式调度模型。] </br>
[①分时调度模型是指让所有的线程轮流获得 cpu 的使用权,并且平均分配每个线程占 用的 CPU 的时间片这个也比较好理解。] </br>  
[②java 虚拟机采用抢占式调度模型，是指优先让可运行池中优先级高的线程占用 CPU，
如果可运行池中的线程优先级相同，那么就随机选择一个线程，使其占用 CPU。处于运行状态的线程会一直运行，直至它不得不放弃 CPU。]




##举例描述什么叫线程上下文切换？
在上下文切换过程中，CPU 会停止处理当前运行的程序，并保存当前程序运行的
具体位置以便之后继续运行。从这个角度来看，上下文切换有点像我们同时阅读
几本书，在来回切换书本的同时我们需要记住每本书当前读到的页码。在程序中，
上下文切换过程中的“页码”信息是保存在进程控制块（PCB）中的。PCB 还经
常被称作“切换桢”（switchframe）。“页码”信息会一直保存到 CPU 的内存中，直到他们被再次使用。
上下文切换是存储和恢复 CPU 状态的过程，它使得线程执行能够从中断点恢复执行。
上下文切换是多任务操作系统和多线程环境的基本特征。




#线程描述？
每个线程都有一个程序计数器（记录要执行的下一条指令），一组寄存器（保存当前线程的工作变量），堆栈（记录执行历史，其中每一帧保存了一个已经调用但未返回的过程）。
寄存器 是 CPU 内部的数量较少但是速度很快的内存（与之对应的是 CPU 外部相对较慢的 RAM 主内存）。寄存器通过对常用值（通常是运算的中间值）的快速访问来提高计算机程序运行的速度。
程序计数器是一个专用的寄存器，用于表明指令序列中 CPU 正在执行的位置，存的值为正在执行的指令的位置或者下一个将要被执行的指令的位置。



#线程上下文切换会有什么问题呢？
上下文切换会导致额外的开销，常常表现为高并发执行时速度会慢串行，因此减少上下文切换次数便可以提高多线程程序的运行效率。
    ①直接消耗：指的是CPU寄存器需要保存和加载, 系统调度器的代码需要执行, TLB实例需要重新加载, CPU 的pipeline需要刷掉
    ②间接消耗：指的是多核的cache之间得共享数据, 间接消耗对于程序的影响要看线程工作区操作数据的大小


#引起线程上下文切换的原因？
①当前执行任务（线程）的时间片用完之后，系统CPU正常调度下一个任务
②中断处理，在中断处理中，其他程序”打断”了当前正在运行的程序。当CPU接收到中断请求时，会在正在运行的程序和发起中断请求的程序之间进行一次上下文切换。中断分为硬件中断和软件中断，软件中断包括因为IO阻塞、未抢到资源或者用户代码等原因，线程被挂起。
③用户态切换，对于一些操作系统，当进行用户态切换时也会进行一次上下文切换，虽然这不是必须的。
④多个任务抢占锁资源，在多任务处理中，CPU会在不同程序之间来回切换，每个程序都有相应的处理时间片，CPU在两个时间片的间隔中进行上下文切换



